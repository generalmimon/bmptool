#!/bin/sh

BMPSUITE_ZIP_URL=https://entropymine.com/jason/bmpsuite/releases/bmpsuite-2.5.zip

rm -rf samples/diff/bmpsuite-2.5/* samples/in/bmpsuite-2.5/* samples/out/bmpsuite-2.5/* samples/exp/bmpsuite-2.5/*

tmpfile=`mktemp`
curl "$BMPSUITE_ZIP_URL" -o "$tmpfile"
unzip "$tmpfile" -d samples/in 'bmpsuite-2.5/b/*.bmp' 'bmpsuite-2.5/g/*.bmp' 'bmpsuite-2.5/q/*.bmp'
unzip "$tmpfile" -d samples/exp 'bmpsuite-2.5/html/*.png'

cd samples/exp/bmpsuite-2.5
mkdir b/ g/ q/

# TODO: maybe create symlinks instead
cp html/pal1.png g/pal1wb.png
cp html/pal1.png q/pal1huff.png
cp html/pal4.png g/pal4rle.png
cp html/pal8.png g/pal8-0.png
cp html/pal8.png g/pal8os2.png
cp html/pal8.png g/pal8rle.png
cp html/pal8.png g/pal8topdown.png
cp html/pal8.png g/pal8v4.png
cp html/pal8.png g/pal8v5.png
cp html/pal8.png q/pal8offs.png
cp html/pal8.png q/pal8os2-hs.png
cp html/pal8.png q/pal8os2-sz.png
cp html/pal8.png q/pal8os2sp.png
cp html/pal8.png q/pal8os2v2-16.png
cp html/pal8.png q/pal8os2v2-40sz.png
cp html/pal8.png q/pal8os2v2-sz.png
cp html/pal8.png q/pal8os2v2.png
cp html/pal8.png q/pal8oversizepal.png
cp html/rgb16-565.png g/rgb16-565pal.png
cp html/rgb16.png g/rgb16bfdef.png
cp html/rgb24.png g/rgb24pal.png
cp html/rgb24.png g/rgb32.png
cp html/rgb24.png g/rgb32bf.png
cp html/rgb24.png g/rgb32bfdef.png
cp html/rgb24.png q/rgb24largepal.png
cp html/rgb24.png q/rgb24lprof.png
cp html/rgb24.png q/rgb24png.png
cp html/rgb24.png q/rgb24prof.png
cp html/rgb24.png q/rgb24prof2.png
cp html/rgb24.png q/rgb32-111110.png
cp html/rgb24.png q/rgb32-xbgr.png
cp html/rgb24.png q/rgb32fakealpha.png
cp html/rgb24.png q/rgb32h52.png
cp html/rgba32.png q/rgba32abf.png
cp html/rgba32.png q/rgba32h56.png

cd ../../in/bmpsuite-2.5
for file in */*.bmp
do
    file_id=`basename $file .bmp`
    [ -f ../../exp/bmpsuite-2.5/html/$file_id.png ] && mv -v ../../exp/bmpsuite-2.5/html/$file_id.png ../../exp/bmpsuite-2.5/$(basename $(dirname $file))/$file_id.png
done

cd ../../out
[ -d bmpsuite-2.5/ ] || mkdir bmpsuite-2.5/ && cd bmpsuite-2.5/ && mkdir b/ g/ q/
